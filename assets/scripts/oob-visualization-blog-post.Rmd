---
title: "Blog Post"
author: "Mike Talbot"
date: 2026-01-21
output: html_document
---

```{r download-data}
library(tidyverse)
library(terra)
library(tidyterra)
library(colorspace)
library(legendry)

data <- readRDS("assets/scripts/USGS_Max_Observations.rds")

p1 <- ggplot(data) +
    geom_histogram(aes(x = largest_observation)) +
    scale_x_continuous(name = "Binned peak streamflow (m^3/s)") +
    scale_y_continuous(name = "Number of Stations") +
    theme_bw()

ggsave("images/oob_histogram.png", p1, dpi = 300, width = 7, height = 4, units = "in")

us_states <- vect(rnaturalearth::ne_states(country = "United States of America", returnclass = "sf")) %>%
    project("EPSG:5070") %>%
    dplyr::select(postal) %>%
    dplyr::rename("state" = "postal") %>% 
    dplyr::filter(!(state %in% c("AK", "HI")))

p2 <- ggplot() +
    geom_spatvector(data = us_states,
        alpha = 1, 
        linewidth = 0.5, 
        fill = "white") +
    geom_spatvector(data = data, 
        aes(color = largest_observation),
        size = 1) +
    scale_color_continuous_sequential(
        name = "Peak Q (m^3/s)", 
        palette = "Viridis", 
        rev = T,
        limits = c(0, NA)
    ) +
    theme_void() +
    theme(
        legend.key.height = grid::unit(0.4, "in"),
        legend.key.width  = grid::unit(0.2,  "in")
    )

ggsave("images/oob_map_complete.png", p2, dpi = 300, width = 7, height = 4, units = "in")

p3 <- ggplot() +
    geom_spatvector(data = us_states,
        alpha = 1, 
        linewidth = 0.5, 
        fill = "white") +
    geom_spatvector(data = data, 
        aes(color = largest_observation),
        size = 1) +
    scale_color_continuous_sequential(
        name = "Peak Q (m^3/s)", 
        palette = "Viridis", 
        rev = T,
        limits = c(0, 1000),
        oob = scales::oob_squish
    ) +
    theme_void() +
    theme(
        legend.key.height = grid::unit(0.4, "in"),
        legend.key.width  = grid::unit(0.2,  "in")
    )

ggsave("images/oob_map_clipped.png", p3, dpi = 300, width = 7, height = 4, units = "in")

p4 <- ggplot() +
    geom_spatvector(data = us_states,
        alpha = 1, 
        linewidth = 0.5, 
        fill = "white") +
    geom_spatvector(data = data, 
        aes(color = largest_observation),
        size = 1) +
    scale_color_continuous_sequential(
        name = "Peak Q (m^3/s)", 
        palette = "Viridis", 
        rev = T,
        limits = c(0, 1000),
        oob = scales::oob_squish,
        guide  = legendry::guide_colbar(
          shape = "triangle",
          show  = NA,
          oob   = "squish",
          theme = theme(
            legend.key.height = grid::unit(2, "in"),
            legend.key.width  = grid::unit(0.2,  "in")
            )
          )
    ) +
    theme_void()

ggsave("images/oob_map_clipped_with_endcaps.png", p4, dpi = 300, width = 7, height = 4, units = "in")
```